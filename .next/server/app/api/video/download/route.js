"use strict";(()=>{var e={};e.id=453,e.ids=[453],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},5215:(e,o,r)=>{r.r(o),r.d(o,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>u});var t={};r.r(t),r.d(t,{GET:()=>c});var s=r(9303),a=r(8716),n=r(3131),i=r(9712);async function c(e){try{let o=new URL(e.url).searchParams.get("url");if(!o)return console.error("未提供视频URL"),Response.json({success:!1,message:"未提供视频URL"},{status:400});console.log("开始下载视频:",o);let r=new URL(o),t=r.hostname,s=["interactive-examples.mdn.mozilla.net","media.w3.org","techslides.com"].some(e=>t.includes(e));console.log("视频主机名:",t,"是否允许域:",s);let a={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36",Accept:"*/*","Accept-Language":"zh-CN,zh;q=0.9,en;q=0.8","Cache-Control":"no-cache",Pragma:"no-cache"};s&&(a.Referer=o,a.Origin=r.origin),console.log("使用以下头部尝试下载:",a);try{let e=await fetch(o,{headers:a,cache:"no-cache",next:{revalidate:0}});if(!e.ok)throw console.error("视频下载失败，状态码:",e.status),Error(`下载失败，状态码: ${e.status}`);let r=e.headers.get("content-type")||"video/mp4";return console.log("下载成功，内容类型:",r),new Response(e.body,{status:200,headers:{"Content-Type":r,"Content-Disposition":'attachment; filename="video.mp4"',"Access-Control-Allow-Origin":"*","Cache-Control":"no-cache"}})}catch(e){console.error("fetch下载失败:",e);try{console.log("尝试使用axios下载...");let e=await i.Z.get(o,{responseType:"arraybuffer",headers:a,timeout:3e4,maxRedirects:5}),r=e.data,t=e.headers["content-type"]||"video/mp4";return console.log("axios下载成功，内容类型:",t),new Response(r,{status:200,headers:{"Content-Type":t,"Content-Disposition":'attachment; filename="video.mp4"',"Access-Control-Allow-Origin":"*","Cache-Control":"no-cache"}})}catch(e){throw console.error("axios下载也失败:",e),e}}}catch(r){console.error("视频下载最终失败:",r.message);let e="视频下载失败",o=500;return r.response?e=403===(o=r.response.status)?"该视频被保护，无法直接下载。请尝试在线观看。":404===o?"找不到视频资源，请检查链接是否有效。":`服务器返回错误: ${o}`:"ECONNABORTED"===r.code?(e="视频下载超时，请稍后再试。",o=504):e=r.message||"下载过程中发生未知错误",Response.json({success:!1,message:e},{status:o})}}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/video/download/route",pathname:"/api/video/download",filename:"route",bundlePath:"app/api/video/download/route"},resolvedPagePath:"E:\\Program Files\\Code\\Cursor\\video-analysis-coze\\app\\api\\video\\download\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:d}=l,h="/api/video/download/route";function m(){return(0,n.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:u})}}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),t=o.X(0,[948,165],()=>r(5215));module.exports=t})();